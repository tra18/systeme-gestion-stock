<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Employés</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDE-TBWNZ_Y4WdPHaezRXIf1vizPEralVY",
            authDomain: "stock-bcbd3.firebaseapp.com",
            projectId: "stock-bcbd3",
            storageBucket: "stock-bcbd3.appspot.com",
            messagingSenderId: "901950451449",
            appId: "1:901950451449:web:stock-bcbd3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        async function testEmployes() {
            try {
                console.log('Test de connexion et chargement des employés...');
                
                // Se connecter avec un compte DG
                const userCredential = await signInWithEmailAndPassword(auth, 'dg@test.com', 'password123');
                console.log('Utilisateur connecté:', userCredential.user);
                
                // Charger les employés
                const employesQuery = collection(db, 'employes');
                const snapshot = await getDocs(employesQuery);
                console.log('Snapshot des employés:', snapshot);
                console.log('Nombre de documents:', snapshot.docs.length);
                
                const employesData = snapshot.docs.map(doc => {
                    const data = doc.data();
                    console.log('Document employé:', doc.id, data);
                    return { id: doc.id, ...data };
                });
                
                console.log('Employés trouvés:', employesData);
                
                if (employesData.length === 0) {
                    console.warn('Aucun employé trouvé dans la collection "employes"');
                } else {
                    console.log('Employés chargés avec succès:', employesData.length);
                }
                
            } catch (error) {
                console.error('Erreur lors du test:', error);
            }
        }

        // Exposer la fonction globalement
        window.testEmployes = testEmployes;
    </script>
</head>
<body>
    <h1>Test de chargement des employés</h1>
    <button onclick="testEmployes()">Tester le chargement des employés</button>
    <div id="result"></div>
    
    <script>
        // Afficher les résultats
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            document.getElementById('result').innerHTML += '<p style="color: green;">LOG: ' + args.join(' ') + '</p>';
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            document.getElementById('result').innerHTML += '<p style="color: orange;">WARN: ' + args.join(' ') + '</p>';
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            document.getElementById('result').innerHTML += '<p style="color: red;">ERROR: ' + args.join(' ') + '</p>';
        };
    </script>
</body>
</html>
